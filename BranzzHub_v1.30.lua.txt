-- BranzzHub v1.0
-- Script completo com UI arrastável e todas as funcionalidades

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

-- Variáveis de controle
local antiTsunamiEnabled = false
local godModeEnabled = false
local vipBypassEnabled = false
local espPlayerEnabled = false

local espObjects = {}
local tsunamiConnection = nil
local godModeConnection = nil
local vipBypassConnection = nil
local espConnection = nil

-- Criar ScreenGui principal
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "BranzzHub"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.Parent = PlayerGui

-- Frame principal
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 500, 0, 400)
MainFrame.Position = UDim2.new(0.5, -250, 0.5, -200)
MainFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
MainFrame.BorderSizePixel = 0
MainFrame.ClipsDescendants = true
MainFrame.Parent = ScreenGui

local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 10)
MainCorner.Parent = MainFrame

-- Barra de título
local TitleBar = Instance.new("Frame")
TitleBar.Name = "TitleBar"
TitleBar.Size = UDim2.new(1, 0, 0, 40)
TitleBar.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
TitleBar.BorderSizePixel = 0
TitleBar.Parent = MainFrame

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 10)
TitleCorner.Parent = TitleBar

local TitleLabel = Instance.new("TextLabel")
TitleLabel.Name = "TitleLabel"
TitleLabel.Size = UDim2.new(0, 200, 1, 0)
TitleLabel.Position = UDim2.new(0, 10, 0, 0)
TitleLabel.BackgroundTransparency = 1
TitleLabel.Text = "BranzzHub v1.0"
TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
TitleLabel.TextSize = 18
TitleLabel.Font = Enum.Font.GothamBold
TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
TitleLabel.Parent = TitleBar

-- Botão Minimizar
local MinimizeButton = Instance.new("TextButton")
MinimizeButton.Name = "MinimizeButton"
MinimizeButton.Size = UDim2.new(0, 30, 0, 30)
MinimizeButton.Position = UDim2.new(1, -100, 0, 5)
MinimizeButton.BackgroundColor3 = Color3.fromRGB(255, 200, 0)
MinimizeButton.Text = "-"
MinimizeButton.TextColor3 = Color3.fromRGB(0, 0, 0)
MinimizeButton.TextSize = 20
MinimizeButton.Font = Enum.Font.GothamBold
MinimizeButton.BorderSizePixel = 0
MinimizeButton.Parent = TitleBar

local MinCorner = Instance.new("UICorner")
MinCorner.CornerRadius = UDim.new(0, 6)
MinCorner.Parent = MinimizeButton

-- Botão Maximizar (inicialmente invisível)
local MaximizeButton = Instance.new("TextButton")
MaximizeButton.Name = "MaximizeButton"
MaximizeButton.Size = UDim2.new(0, 120, 0, 40)
MaximizeButton.Position = UDim2.new(0.5, -60, 0.5, -20)
MaximizeButton.BackgroundColor3 = Color3.fromRGB(255, 200, 0)
MaximizeButton.Text = "Maximizar"
MaximizeButton.TextColor3 = Color3.fromRGB(0, 0, 0)
MaximizeButton.TextSize = 16
MaximizeButton.Font = Enum.Font.GothamBold
MaximizeButton.BorderSizePixel = 0
MaximizeButton.Visible = false
MaximizeButton.Parent = ScreenGui

local MaxCorner = Instance.new("UICorner")
MaxCorner.CornerRadius = UDim.new(0, 8)
MaxCorner.Parent = MaximizeButton

-- Botão Fechar
local CloseButton = Instance.new("TextButton")
CloseButton.Name = "CloseButton"
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(1, -35, 0, 5)
CloseButton.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.TextSize = 18
CloseButton.Font = Enum.Font.GothamBold
CloseButton.BorderSizePixel = 0
CloseButton.Parent = TitleBar

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 6)
CloseCorner.Parent = CloseButton

-- Barra lateral de abas
local SideBar = Instance.new("Frame")
SideBar.Name = "SideBar"
SideBar.Size = UDim2.new(0, 120, 1, -40)
SideBar.Position = UDim2.new(0, 0, 0, 40)
SideBar.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
SideBar.BorderSizePixel = 0
SideBar.Parent = MainFrame

-- Container de conteúdo
local ContentFrame = Instance.new("Frame")
ContentFrame.Name = "ContentFrame"
ContentFrame.Size = UDim2.new(1, -120, 1, -40)
ContentFrame.Position = UDim2.new(0, 120, 0, 40)
ContentFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
ContentFrame.BorderSizePixel = 0
ContentFrame.Parent = MainFrame

-- Função para criar botão de aba
local function CreateTabButton(text, position, parent)
    local button = Instance.new("TextButton")
    button.Name = text .. "Tab"
    button.Size = UDim2.new(1, -10, 0, 50)
    button.Position = UDim2.new(0, 5, 0, position)
    button.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
    button.Text = text
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.TextSize = 16
    button.Font = Enum.Font.GothamBold
    button.BorderSizePixel = 0
    button.Parent = parent
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = button
    
    return button
end

-- Função para criar checkbox
local function CreateCheckbox(text, position, parent, callback)
    local container = Instance.new("Frame")
    container.Name = text .. "Container"
    container.Size = UDim2.new(1, -20, 0, 50)
    container.Position = UDim2.new(0, 10, 0, position)
    container.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
    container.BorderSizePixel = 0
    container.Parent = parent
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = container
    
    local checkbox = Instance.new("TextButton")
    checkbox.Name = "Checkbox"
    checkbox.Size = UDim2.new(0, 30, 0, 30)
    checkbox.Position = UDim2.new(0, 10, 0.5, -15)
    checkbox.BackgroundColor3 = Color3.fromRGB(70, 70, 80)
    checkbox.Text = ""
    checkbox.BorderSizePixel = 0
    checkbox.Parent = container
    
    local checkCorner = Instance.new("UICorner")
    checkCorner.CornerRadius = UDim.new(0, 6)
    checkCorner.Parent = checkbox
    
    local checkMark = Instance.new("TextLabel")
    checkMark.Size = UDim2.new(1, 0, 1, 0)
    checkMark.BackgroundTransparency = 1
    checkMark.Text = "✓"
    checkMark.TextColor3 = Color3.fromRGB(0, 255, 0)
    checkMark.TextSize = 24
    checkMark.Font = Enum.Font.GothamBold
    checkMark.Visible = false
    checkMark.Parent = checkbox
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, -50, 1, 0)
    label.Position = UDim2.new(0, 50, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = text
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.TextSize = 14
    label.Font = Enum.Font.Gotham
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = container
    
    local enabled = false
    checkbox.MouseButton1Click:Connect(function()
        enabled = not enabled
        checkMark.Visible = enabled
        if enabled then
            checkbox.BackgroundColor3 = Color3.fromRGB(100, 200, 100)
        else
            checkbox.BackgroundColor3 = Color3.fromRGB(70, 70, 80)
        end
        callback(enabled)
    end)
    
    return container
end

-- Criar abas
local MainTab = CreateTabButton("Main", 10, SideBar)
local VipTab = CreateTabButton("VIP", 70, SideBar)
local EspTab = CreateTabButton("ESP Player", 130, SideBar)

-- Criar páginas de conteúdo
local MainPage = Instance.new("Frame")
MainPage.Name = "MainPage"
MainPage.Size = UDim2.new(1, 0, 1, 0)
MainPage.BackgroundTransparency = 1
MainPage.Visible = true
MainPage.Parent = ContentFrame

local VipPage = Instance.new("Frame")
VipPage.Name = "VipPage"
VipPage.Size = UDim2.new(1, 0, 1, 0)
VipPage.BackgroundTransparency = 1
VipPage.Visible = false
VipPage.Parent = ContentFrame

local EspPage = Instance.new("Frame")
EspPage.Name = "EspPage"
EspPage.Size = UDim2.new(1, 0, 1, 0)
EspPage.BackgroundTransparency = 1
EspPage.Visible = false
EspPage.Parent = ContentFrame

-- Função para trocar de aba
local function SwitchTab(tabName)
    MainPage.Visible = (tabName == "Main")
    VipPage.Visible = (tabName == "VIP")
    EspPage.Visible = (tabName == "ESP")
    
    MainTab.BackgroundColor3 = (tabName == "Main") and Color3.fromRGB(80, 80, 100) or Color3.fromRGB(50, 50, 60)
    VipTab.BackgroundColor3 = (tabName == "VIP") and Color3.fromRGB(80, 80, 100) or Color3.fromRGB(50, 50, 60)
    EspTab.BackgroundColor3 = (tabName == "ESP") and Color3.fromRGB(80, 80, 100) or Color3.fromRGB(50, 50, 60)
end

MainTab.MouseButton1Click:Connect(function() SwitchTab("Main") end)
VipTab.MouseButton1Click:Connect(function() SwitchTab("VIP") end)
EspTab.MouseButton1Click:Connect(function() SwitchTab("ESP") end)

-- ========== FUNÇÕES ==========

-- Função Anti Tsunami
local function AntiTsunami(enabled)
    antiTsunamiEnabled = enabled
    
    if tsunamiConnection then
        tsunamiConnection:Disconnect()
        tsunamiConnection = nil
    end
    
    -- Limpar ESPs anteriores
    for _, esp in pairs(espObjects) do
        if esp.Name == "TsunamiESP" then
            esp:Destroy()
        end
    end
    
    if enabled then
        tsunamiConnection = RunService.Heartbeat:Connect(function()
            local character = LocalPlayer.Character
            if not character or not character:FindFirstChild("HumanoidRootPart") then return end
            
            local hrp = character.HumanoidRootPart
            local activeTsunamis = workspace:FindFirstChild("ActiveTsunamis")
            
            if activeTsunamis then
                local tsunamiModels = activeTsunamis:GetChildren()
                local misc = workspace:FindFirstChild("Misc")
                
                if misc then
                    local gaps = misc:FindFirstChild("Gaps")
                    
                    if gaps then
                        local closestGap = nil
                        local closestDistance = math.huge
                        
                        for _, gap in pairs(gaps:GetChildren()) do
                            if gap:IsA("Model") and gap.Name:match("Gap") then
                                local hud = gap:FindFirstChild("Hud")
                                
                                if hud then
                                    local gapPosition = hud.Position
                                    local distance = (hrp.Position - gapPosition).Magnitude
                                    
                                    -- Verificar se o gap não está atrás ou muito perto de tsunamis
                                    local isSafe = true
                                    for _, tsunami in pairs(tsunamiModels) do
                                        if tsunami:IsA("Model") and tsunami.PrimaryPart then
                                            local tsunamiPos = tsunami.PrimaryPart.Position
                                            local distToTsunami = (gapPosition - tsunamiPos).Magnitude
                                            
                                            if distToTsunami < 50 then
                                                isSafe = false
                                                break
                                            end
                                            
                                            -- Verificar se está atrás do tsunami
                                            local playerToGap = (gapPosition - hrp.Position).Unit
                                            local playerToTsunami = (tsunamiPos - hrp.Position).Unit
                                            
                                            if playerToGap:Dot(playerToTsunami) > 0.7 then
                                                isSafe = false
                                                break
                                            end
                                        end
                                    end
                                    
                                    if isSafe and distance < closestDistance then
                                        closestDistance = distance
                                        closestGap = hud
                                    end
                                end
                            end
                        end
                        
                        -- Criar ESP do gap mais seguro
                        if closestGap then
                            -- Remover ESP antigo
                            for _, obj in pairs(workspace:GetDescendants()) do
                                if obj.Name == "TsunamiESP" then
                                    obj:Destroy()
                                end
                            end
                            
                            local esp = Instance.new("BillboardGui")
                            esp.Name = "TsunamiESP"
                            esp.Adornee = closestGap
                            esp.Size = UDim2.new(0, 100, 0, 50)
                            esp.AlwaysOnTop = true
                            esp.Parent = closestGap
                            
                            local frame = Instance.new("Frame")
                            frame.Size = UDim2.new(1, 0, 1, 0)
                            frame.BackgroundColor3 = Color3.fromRGB(160, 32, 240)
                            frame.BackgroundTransparency = 0.5
                            frame.BorderSizePixel = 2
                            frame.BorderColor3 = Color3.fromRGB(160, 32, 240)
                            frame.Parent = esp
                            
                            local label = Instance.new("TextLabel")
                            label.Size = UDim2.new(1, 0, 1, 0)
                            label.BackgroundTransparency = 1
                            label.Text = "SAFE GAP"
                            label.TextColor3 = Color3.fromRGB(255, 255, 255)
                            label.TextSize = 14
                            label.Font = Enum.Font.GothamBold
                            label.Parent = frame
                            
                            -- Teleportar suavemente para o gap
                            local targetPos = closestGap.Position + Vector3.new(0, 5, 0)
                            hrp.CFrame = CFrame.new(targetPos)
                        end
                    end
                end
            end
        end)
    end
end

-- Função God Mode
local function GodMode(enabled)
    godModeEnabled = enabled
    
    if godModeConnection then
        godModeConnection:Disconnect()
        godModeConnection = nil
    end
    
    if enabled then
        godModeConnection = RunService.Heartbeat:Connect(function()
            local character = LocalPlayer.Character
            if character and character:FindFirstChild("Humanoid") then
                local humanoid = character.Humanoid
                humanoid.MaxHealth = humanoid.MaxHealth + 800
                humanoid.Health = humanoid.Health + 800
            end
        end)
    end
end

-- Função VIP Bypass
local function VipBypass(enabled)
    vipBypassEnabled = enabled
    
    if vipBypassConnection then
        vipBypassConnection:Disconnect()
        vipBypassConnection = nil
    end
    
    if enabled then
        local function processVipWalls()
            local defaultMap = workspace:FindFirstChild("DefaultMap_SharedInstances")
            
            if defaultMap then
                local vipWalls = defaultMap:FindFirstChild("VIPWalls")
                
                if vipWalls then
                    for _, obj in pairs(vipWalls:GetDescendants()) do
                        if obj:IsA("BasePart") and (obj.Name:match("VIP") or obj.Name:match("VIP_ULTRA")) then
                            obj.CanCollide = false
                            obj.Transparency = 0.8
                        end
                    end
                end
            end
        end
        
        processVipWalls()
        
        vipBypassConnection = RunService.Heartbeat:Connect(function()
            processVipWalls()
        end)
    else
        local defaultMap = workspace:FindFirstChild("DefaultMap_SharedInstances")
        
        if defaultMap then
            local vipWalls = defaultMap:FindFirstChild("VIPWalls")
            
            if vipWalls then
                for _, obj in pairs(vipWalls:GetDescendants()) do
                    if obj:IsA("BasePart") then
                        obj.CanCollide = true
                        obj.Transparency = 0
                    end
                end
            end
        end
    end
end

-- Função ESP Player
local function EspPlayer(enabled)
    espPlayerEnabled = enabled
    
    if espConnection then
        espConnection:Disconnect()
        espConnection = nil
    end
    
    -- Limpar ESPs anteriores
    for _, esp in pairs(espObjects) do
        if esp.Name == "PlayerESP" then
            esp:Destroy()
        end
    end
    espObjects = {}
    
    if enabled then
        local function createESP(player)
            local character = player.Character
            if not character or not character:FindFirstChild("HumanoidRootPart") then return end
            
            local hrp = character.HumanoidRootPart
            
            -- ESP Box
            local espBox = Instance.new("BoxHandleAdornment")
            espBox.Name = "PlayerESP"
            espBox.Adornee = hrp
            espBox.Size = Vector3.new(4, 5, 1)
            espBox.Color3 = (player == LocalPlayer) and Color3.fromRGB(160, 32, 240) or Color3.fromRGB(0, 255, 0)
            espBox.Transparency = 0.7
            espBox.AlwaysOnTop = true
            espBox.ZIndex = 10
            espBox.Parent = hrp
            
            table.insert(espObjects, espBox)
            
            -- Linha para outros jogadores
            if player ~= LocalPlayer then
                local beam = Instance.new("Beam")
                local att0 = Instance.new("Attachment")
                local att1 = Instance.new("Attachment")
                
                att0.Parent = LocalPlayer.Character.HumanoidRootPart
                att1.Parent = hrp
                
                beam.Attachment0 = att0
                beam.Attachment1 = att1
                beam.Color = ColorSequence.new(Color3.fromRGB(0, 255, 0))
                beam.Width0 = 0.1
                beam.Width1 = 0.1
                beam.FaceCamera = true
                beam.Parent = hrp
                beam.Name = "PlayerESP"
                
                table.insert(espObjects, beam)
                table.insert(espObjects, att0)
                table.insert(espObjects, att1)
            end
            
            -- Label com nome
            local billboard = Instance.new("BillboardGui")
            billboard.Name = "PlayerESP"
            billboard.Adornee = hrp
            billboard.Size = UDim2.new(0, 100, 0, 40)
            billboard.StudsOffset = Vector3.new(0, 3, 0)
            billboard.AlwaysOnTop = true
            billboard.Parent = hrp
            
            local nameLabel = Instance.new("TextLabel")
            nameLabel.Size = UDim2.new(1, 0, 1, 0)
            nameLabel.BackgroundTransparency = 1
            nameLabel.Text = player.Name
            nameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
            nameLabel.TextSize = 14
            nameLabel.Font = Enum.Font.GothamBold
            nameLabel.TextStrokeTransparency = 0.5
            nameLabel.Parent = billboard
            
            table.insert(espObjects, billboard)
        end
        
        espConnection = RunService.Heartbeat:Connect(function()
            for _, player in pairs(Players:GetPlayers()) do
                if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                    local hasESP = false
                    for _, esp in pairs(espObjects) do
                        if esp.Adornee == player.Character.HumanoidRootPart then
                            hasESP = true
                            break
                        end
                    end
                    
                    if not hasESP then
                        createESP(player)
                    end
                end
            end
        end)
        
        -- ESP inicial
        for _, player in pairs(Players:GetPlayers()) do
            if player.Character then
                createESP(player)
            end
        end
    end
end

-- ========== CRIAR CHECKBOXES ==========

-- Main Page
CreateCheckbox("Anti Tsunami", 10, MainPage, AntiTsunami)
CreateCheckbox("God Mode", 70, MainPage, GodMode)

-- VIP Page
CreateCheckbox("VIP Bypass", 10, VipPage, VipBypass)

-- ESP Page
CreateCheckbox("ESP Players", 10, EspPage, EspPlayer)

-- ========== SISTEMA DE ARRASTAR ==========

local dragging = false
local dragInput
local dragStart
local startPos

local function update(input)
    local delta = input.Position - dragStart
    MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

TitleBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

TitleBar.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        update(input)
    end
end)

-- ========== BOTÕES DE CONTROLE ==========

-- Minimizar
MinimizeButton.MouseButton1Click:Connect(function()
    MainFrame.Visible = false
    MaximizeButton.Visible = true
end)

-- Maximizar
MaximizeButton.MouseButton1Click:Connect(function()
    MainFrame.Visible = true
    MaximizeButton.Visible = false
end)

-- Fechar
CloseButton.MouseButton1Click:Connect(function()
    -- Desativar todas as funções
    AntiTsunami(false)
    GodMode(false)
    VipBypass(false)
    EspPlayer(false)
    
    -- Destruir UI
    ScreenGui:Destroy()
end)

-- Mensagem de carregamento
print("BranzzHub v1.0 carregado com sucesso!")
