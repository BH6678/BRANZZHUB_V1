-- BranzzHub v1.0
-- Script completo com UI arrastável e funções

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

-- Variáveis de controle
local antiTsunamiEnabled = false
local godModeEnabled = false
local vipWallsEnabled = false
local espPlayerEnabled = false

local espBoxes = {}
local currentGapESP = nil
local connections = {}

-- Criar ScreenGui principal
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "BranzzHub"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.Parent = PlayerGui

-- Frame principal
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 500, 0, 400)
MainFrame.Position = UDim2.new(0.5, -250, 0.5, -200)
MainFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
MainFrame.BorderSizePixel = 0
MainFrame.Parent = ScreenGui

local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 8)
MainCorner.Parent = MainFrame

-- Barra de título
local TitleBar = Instance.new("Frame")
TitleBar.Name = "TitleBar"
TitleBar.Size = UDim2.new(1, 0, 0, 40)
TitleBar.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
TitleBar.BorderSizePixel = 0
TitleBar.Parent = MainFrame

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 8)
TitleCorner.Parent = TitleBar

-- Texto do título
local TitleLabel = Instance.new("TextLabel")
TitleLabel.Name = "TitleLabel"
TitleLabel.Size = UDim2.new(1, -120, 1, 0)
TitleLabel.Position = UDim2.new(0, 10, 0, 0)
TitleLabel.BackgroundTransparency = 1
TitleLabel.Text = "BranzzHub v1.0"
TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
TitleLabel.TextSize = 18
TitleLabel.Font = Enum.Font.GothamBold
TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
TitleLabel.Parent = TitleBar

-- Botão Minimizar
local MinimizeButton = Instance.new("TextButton")
MinimizeButton.Name = "MinimizeButton"
MinimizeButton.Size = UDim2.new(0, 35, 0, 35)
MinimizeButton.Position = UDim2.new(1, -115, 0.5, -17.5)
MinimizeButton.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
MinimizeButton.Text = "-"
MinimizeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
MinimizeButton.TextSize = 20
MinimizeButton.Font = Enum.Font.GothamBold
MinimizeButton.Parent = TitleBar

local MinCorner = Instance.new("UICorner")
MinCorner.CornerRadius = UDim.new(0, 6)
MinCorner.Parent = MinimizeButton

-- Botão Maximizar
local MaximizeButton = Instance.new("TextButton")
MaximizeButton.Name = "MaximizeButton"
MaximizeButton.Size = UDim2.new(0, 35, 0, 35)
MaximizeButton.Position = UDim2.new(1, -75, 0.5, -17.5)
MaximizeButton.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
MaximizeButton.Text = "□"
MaximizeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
MaximizeButton.TextSize = 16
MaximizeButton.Font = Enum.Font.GothamBold
MaximizeButton.Visible = false
MaximizeButton.Parent = TitleBar

local MaxCorner = Instance.new("UICorner")
MaxCorner.CornerRadius = UDim.new(0, 6)
MaxCorner.Parent = MaximizeButton

-- Botão Fechar
local CloseButton = Instance.new("TextButton")
CloseButton.Name = "CloseButton"
CloseButton.Size = UDim2.new(0, 35, 0, 35)
CloseButton.Position = UDim2.new(1, -35, 0.5, -17.5)
CloseButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.TextSize = 16
CloseButton.Font = Enum.Font.GothamBold
CloseButton.Parent = TitleBar

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 6)
CloseCorner.Parent = CloseButton

-- Container de conteúdo
local ContentFrame = Instance.new("Frame")
ContentFrame.Name = "ContentFrame"
ContentFrame.Size = UDim2.new(1, 0, 1, -40)
ContentFrame.Position = UDim2.new(0, 0, 0, 40)
ContentFrame.BackgroundTransparency = 1
ContentFrame.Parent = MainFrame

-- Barra lateral de abas
local SideBar = Instance.new("Frame")
SideBar.Name = "SideBar"
SideBar.Size = UDim2.new(0, 120, 1, 0)
SideBar.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
SideBar.BorderSizePixel = 0
SideBar.Parent = ContentFrame

-- Área de conteúdo das abas
local TabContent = Instance.new("Frame")
TabContent.Name = "TabContent"
TabContent.Size = UDim2.new(1, -120, 1, 0)
TabContent.Position = UDim2.new(0, 120, 0, 0)
TabContent.BackgroundTransparency = 1
TabContent.Parent = ContentFrame

-- Função para criar botões de aba
local function createTabButton(name, position)
    local TabButton = Instance.new("TextButton")
    TabButton.Name = name .. "Tab"
    TabButton.Size = UDim2.new(1, -10, 0, 45)
    TabButton.Position = UDim2.new(0, 5, 0, position)
    TabButton.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
    TabButton.Text = name
    TabButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    TabButton.TextSize = 14
    TabButton.Font = Enum.Font.GothamSemibold
    TabButton.Parent = SideBar
    
    local Corner = Instance.new("UICorner")
    Corner.CornerRadius = UDim.new(0, 6)
    Corner.Parent = TabButton
    
    return TabButton
end

-- Criar botões das abas
local MainTab = createTabButton("Main", 10)
local VipTab = createTabButton("VIP", 65)
local ESPTab = createTabButton("ESP Player", 120)

-- Função para criar checkbox
local function createCheckbox(parent, text, yPosition, callback)
    local Container = Instance.new("Frame")
    Container.Size = UDim2.new(1, -20, 0, 40)
    Container.Position = UDim2.new(0, 10, 0, yPosition)
    Container.BackgroundTransparency = 1
    Container.Parent = parent
    
    local CheckButton = Instance.new("TextButton")
    CheckButton.Size = UDim2.new(0, 30, 0, 30)
    CheckButton.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
    CheckButton.Text = ""
    CheckButton.Parent = Container
    
    local CheckCorner = Instance.new("UICorner")
    CheckCorner.CornerRadius = UDim.new(0, 6)
    CheckCorner.Parent = CheckButton
    
    local CheckMark = Instance.new("TextLabel")
    CheckMark.Size = UDim2.new(1, 0, 1, 0)
    CheckMark.BackgroundTransparency = 1
    CheckMark.Text = "✓"
    CheckMark.TextColor3 = Color3.fromRGB(100, 200, 100)
    CheckMark.TextSize = 20
    CheckMark.Font = Enum.Font.GothamBold
    CheckMark.Visible = false
    CheckMark.Parent = CheckButton
    
    local Label = Instance.new("TextLabel")
    Label.Size = UDim2.new(1, -40, 1, 0)
    Label.Position = UDim2.new(0, 40, 0, 0)
    Label.BackgroundTransparency = 1
    Label.Text = text
    Label.TextColor3 = Color3.fromRGB(255, 255, 255)
    Label.TextSize = 14
    Label.Font = Enum.Font.Gotham
    Label.TextXAlignment = Enum.TextXAlignment.Left
    Label.Parent = Container
    
    local isChecked = false
    
    CheckButton.MouseButton1Click:Connect(function()
        isChecked = not isChecked
        CheckMark.Visible = isChecked
        CheckButton.BackgroundColor3 = isChecked and Color3.fromRGB(60, 120, 60) or Color3.fromRGB(45, 45, 55)
        callback(isChecked)
    end)
    
    return Container
end

-- Criar páginas das abas
local MainPage = Instance.new("ScrollingFrame")
MainPage.Name = "MainPage"
MainPage.Size = UDim2.new(1, -10, 1, -10)
MainPage.Position = UDim2.new(0, 5, 0, 5)
MainPage.BackgroundTransparency = 1
MainPage.ScrollBarThickness = 6
MainPage.ScrollBarImageColor3 = Color3.fromRGB(100, 100, 110)
MainPage.BorderSizePixel = 0
MainPage.CanvasSize = UDim2.new(0, 0, 0, 200)
MainPage.Visible = true
MainPage.Parent = TabContent

local VipPage = Instance.new("ScrollingFrame")
VipPage.Name = "VipPage"
VipPage.Size = UDim2.new(1, -10, 1, -10)
VipPage.Position = UDim2.new(0, 5, 0, 5)
VipPage.BackgroundTransparency = 1
VipPage.ScrollBarThickness = 6
VipPage.ScrollBarImageColor3 = Color3.fromRGB(100, 100, 110)
VipPage.BorderSizePixel = 0
VipPage.CanvasSize = UDim2.new(0, 0, 0, 200)
VipPage.Visible = false
VipPage.Parent = TabContent

local ESPPage = Instance.new("ScrollingFrame")
ESPPage.Name = "ESPPage"
ESPPage.Size = UDim2.new(1, -10, 1, -10)
ESPPage.Position = UDim2.new(0, 5, 0, 5)
ESPPage.BackgroundTransparency = 1
ESPPage.ScrollBarThickness = 6
ESPPage.ScrollBarImageColor3 = Color3.fromRGB(100, 100, 110)
ESPPage.BorderSizePixel = 0
ESPPage.CanvasSize = UDim2.new(0, 0, 0, 200)
ESPPage.Visible = false
ESPPage.Parent = TabContent

-- Sistema de navegação entre abas
local function switchTab(tabName)
    MainPage.Visible = false
    VipPage.Visible = false
    ESPPage.Visible = false
    
    MainTab.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
    VipTab.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
    ESPTab.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
    
    if tabName == "Main" then
        MainPage.Visible = true
        MainTab.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
    elseif tabName == "VIP" then
        VipPage.Visible = true
        VipTab.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
    elseif tabName == "ESP" then
        ESPPage.Visible = true
        ESPTab.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
    end
end

MainTab.MouseButton1Click:Connect(function() switchTab("Main") end)
VipTab.MouseButton1Click:Connect(function() switchTab("VIP") end)
ESPTab.MouseButton1Click:Connect(function() switchTab("ESP") end)

-- Inicializar na aba Main
switchTab("Main")

-- FUNCIONALIDADES

-- 1. Anti Tsunami
local function findNearestSafeGap(tsunamiModels)
    local character = LocalPlayer.Character
    if not character or not character:FindFirstChild("HumanoidRootPart") then return nil end
    
    local rootPos = character.HumanoidRootPart.Position
    local nearestGap = nil
    local nearestDistance = math.huge
    
    local Misc = workspace:FindFirstChild("Misc")
    if not Misc then return nil end
    
    local Gaps = Misc:FindFirstChild("Gaps")
    if not Gaps then return nil end
    
    for _, gap in pairs(Gaps:GetChildren()) do
        if gap:IsA("Model") and gap.Name:match("^Gap") then
            local hud = gap:FindFirstChild("Hud")
            if hud and hud:IsA("BasePart") then
                local gapPos = hud.Position
                local distance = (rootPos - gapPos).Magnitude
                
                -- Verificar se o gap não está atrás ou muito perto do tsunami
                local isSafe = true
                for _, tsunami in pairs(tsunamiModels) do
                    if tsunami:IsA("Model") and tsunami.PrimaryPart then
                        local tsunamiPos = tsunami.PrimaryPart.Position
                        local toGap = (gapPos - rootPos).Unit
                        local toTsunami = (tsunamiPos - rootPos).Unit
                        
                        -- Não considerar gaps que estão na direção do tsunami
                        if toGap:Dot(toTsunami) > 0.5 then
                            isSafe = false
                            break
                        end
                    end
                end
                
                if isSafe and distance < nearestDistance then
                    nearestDistance = distance
                    nearestGap = hud
                end
            end
        end
    end
    
    return nearestGap
end

local function createGapESP(part)
    if currentGapESP then
        currentGapESP:Destroy()
    end
    
    local BillboardGui = Instance.new("BillboardGui")
    BillboardGui.AlwaysOnTop = true
    BillboardGui.Size = UDim2.new(0, 100, 0, 50)
    BillboardGui.Adornee = part
    BillboardGui.Parent = part
    
    local Frame = Instance.new("Frame")
    Frame.Size = UDim2.new(1, 0, 1, 0)
    Frame.BackgroundColor3 = Color3.fromRGB(150, 50, 200)
    Frame.BackgroundTransparency = 0.5
    Frame.BorderSizePixel = 2
    Frame.BorderColor3 = Color3.fromRGB(200, 100, 255)
    Frame.Parent = BillboardGui
    
    local Label = Instance.new("TextLabel")
    Label.Size = UDim2.new(1, 0, 1, 0)
    Label.BackgroundTransparency = 1
    Label.Text = "SAFE GAP"
    Label.TextColor3 = Color3.fromRGB(255, 255, 255)
    Label.TextSize = 14
    Label.Font = Enum.Font.GothamBold
    Label.Parent = Frame
    
    currentGapESP = BillboardGui
end

local antiTsunamiConnection
createCheckbox(MainPage, "Anti Tsunami", 10, function(enabled)
    antiTsunamiEnabled = enabled
    
    if antiTsunamiConnection then
        antiTsunamiConnection:Disconnect()
        antiTsunamiConnection = nil
    end
    
    if currentGapESP then
        currentGapESP:Destroy()
        currentGapESP = nil
    end
    
    if enabled then
        antiTsunamiConnection = RunService.Heartbeat:Connect(function()
            local ActiveTsunamis = workspace:FindFirstChild("ActiveTsunamis")
            if ActiveTsunamis then
                local tsunamis = ActiveTsunamis:GetChildren()
                if #tsunamis > 0 then
                    local safeGap = findNearestSafeGap(tsunamis)
                    if safeGap then
                        createGapESP(safeGap)
                        
                        -- Mover jogador para o gap
                        local character = LocalPlayer.Character
                        if character and character:FindFirstChild("HumanoidRootPart") then
                            local targetPos = safeGap.Position + Vector3.new(0, 5, 0)
                            character.HumanoidRootPart.CFrame = CFrame.new(targetPos)
                        end
                    end
                end
            end
        end)
    end
end)

-- 2. God Mode
local godModeConnection
createCheckbox(MainPage, "God Mode", 60, function(enabled)
    godModeEnabled = enabled
    
    if godModeConnection then
        godModeConnection:Disconnect()
        godModeConnection = nil
    end
    
    if enabled then
        godModeConnection = RunService.Heartbeat:Connect(function()
            local character = LocalPlayer.Character
            if character and character:FindFirstChild("Humanoid") then
                local humanoid = character.Humanoid
                humanoid.MaxHealth = math.huge
                humanoid.Health = math.huge
            end
        end)
    end
end)

-- 3. VIP Walls
local vipWallsConnection
createCheckbox(VipPage, "VIP Walls Bypass", 10, function(enabled)
    vipWallsEnabled = enabled
    
    if vipWallsConnection then
        vipWallsConnection:Disconnect()
        vipWallsConnection = nil
    end
    
    if enabled then
        local function processVIPWalls()
            local VIPWalls = workspace:FindFirstChild("VIPWalls")
            if VIPWalls then
                for _, obj in pairs(VIPWalls:GetDescendants()) do
                    if obj:IsA("BasePart") and (obj.Name:match("VIP") or obj.Name:match("VIP_ULTRA")) then
                        obj.CanCollide = false
                    end
                end
            end
        end
        
        vipWallsConnection = RunService.Heartbeat:Connect(processVIPWalls)
        processVIPWalls()
    else
        local VIPWalls = workspace:FindFirstChild("VIPWalls")
        if VIPWalls then
            for _, obj in pairs(VIPWalls:GetDescendants()) do
                if obj:IsA("BasePart") then
                    obj.CanCollide = true
                end
            end
        end
    end
end)

-- 4. ESP Player
local function createPlayerESP(player)
    local function createESPForCharacter(character)
        if espBoxes[player] then
            espBoxes[player]:Destroy()
        end
        
        local hrp = character:WaitForChild("HumanoidRootPart", 5)
        if not hrp then return end
        
        local BillboardGui = Instance.new("BillboardGui")
        BillboardGui.AlwaysOnTop = true
        BillboardGui.Size = UDim2.new(0, 100, 0, 150)
        BillboardGui.Adornee = hrp
        BillboardGui.Parent = hrp
        
        -- Box
        local Box = Instance.new("Frame")
        Box.Size = UDim2.new(1, 0, 1, 0)
        Box.BackgroundTransparency = 1
        Box.BorderSizePixel = 2
        
        if player == LocalPlayer then
            Box.BorderColor3 = Color3.fromRGB(150, 50, 200) -- Roxo para o próprio jogador
        else
            Box.BorderColor3 = Color3.fromRGB(50, 200, 50) -- Verde para outros
        end
        
        Box.Parent = BillboardGui
        
        -- Nome
        local NameLabel = Instance.new("TextLabel")
        NameLabel.Size = UDim2.new(1, 0, 0, 20)
        NameLabel.Position = UDim2.new(0, 0, 0, -25)
        NameLabel.BackgroundTransparency = 1
        NameLabel.Text = player.Name
        NameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
        NameLabel.TextSize = 12
        NameLabel.Font = Enum.Font.GothamBold
        NameLabel.TextStrokeTransparency = 0.5
        NameLabel.Parent = BillboardGui
        
        -- Linha para o chão
        local Attachment0 = Instance.new("Attachment")
        Attachment0.Parent = hrp
        
        local Attachment1 = Instance.new("Attachment")
        Attachment1.Parent = workspace.Terrain
        Attachment1.WorldPosition = hrp.Position - Vector3.new(0, hrp.Position.Y, 0)
        
        local Beam = Instance.new("Beam")
        Beam.Attachment0 = Attachment0
        Beam.Attachment1 = Attachment1
        Beam.Width0 = 0.1
        Beam.Width1 = 0.1
        Beam.Color = ColorSequence.new(player == LocalPlayer and Color3.fromRGB(150, 50, 200) or Color3.fromRGB(50, 200, 50))
        Beam.FaceCamera = true
        Beam.Parent = hrp
        
        espBoxes[player] = BillboardGui
        
        -- Atualizar posição da linha
        RunService.RenderStepped:Connect(function()
            if Attachment1 and hrp then
                Attachment1.WorldPosition = hrp.Position - Vector3.new(0, hrp.Position.Y, 0)
            end
        end)
    end
    
    if player.Character then
        createESPForCharacter(player.Character)
    end
    
    player.CharacterAdded:Connect(createESPForCharacter)
end

local function removePlayerESP(player)
    if espBoxes[player] then
        espBoxes[player]:Destroy()
        espBoxes[player] = nil
    end
end

createCheckbox(ESPPage, "ESP Players", 10, function(enabled)
    espPlayerEnabled = enabled
    
    if enabled then
        for _, player in pairs(Players:GetPlayers()) do
            createPlayerESP(player)
        end
        
        connections.playerAdded = Players.PlayerAdded:Connect(function(player)
            if espPlayerEnabled then
                createPlayerESP(player)
            end
        end)
        
        connections.playerRemoving = Players.PlayerRemoving:Connect(function(player)
            removePlayerESP(player)
        end)
    else
        for player, _ in pairs(espBoxes) do
            removePlayerESP(player)
        end
        
        if connections.playerAdded then
            connections.playerAdded:Disconnect()
        end
        if connections.playerRemoving then
            connections.playerRemoving:Disconnect()
        end
    end
end)

-- Sistema de arrastar
local dragging = false
local dragInput
local dragStart
local startPos

local function update(input)
    local delta = input.Position - dragStart
    MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

TitleBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

TitleBar.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        update(input)
    end
end)

-- Botões de controle
MinimizeButton.MouseButton1Click:Connect(function()
    MainFrame.Visible = false
    MaximizeButton.Visible = true
    MaximizeButton.Parent = ScreenGui
    MaximizeButton.Position = UDim2.new(1, -50, 0, 10)
end)

MaximizeButton.MouseButton1Click:Connect(function()
    MainFrame.Visible = true
    MaximizeButton.Visible = false
    MaximizeButton.Parent = TitleBar
    MaximizeButton.Position = UDim2.new(1, -75, 0.5, -17.5)
end)

CloseButton.MouseButton1Click:Connect(function()
    -- Desconectar todas as funções
    if antiTsunamiConnection then antiTsunamiConnection:Disconnect() end
    if godModeConnection then godModeConnection:Disconnect() end
    if vipWallsConnection then vipWallsConnection:Disconnect() end
    
    for _, connection in pairs(connections) do
        connection:Disconnect()
    end
    
    for player, _ in pairs(espBoxes) do
        removePlayerESP(player)
    end
    
    if currentGapESP then
        currentGapESP:Destroy()
    end
    
    ScreenGui:Destroy()
end)

print("BranzzHub v1.0 carregado com sucesso!")
